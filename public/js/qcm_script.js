// QCM Questions  HTML
const htmlQuestions = [
  (q1 = {
    question: "What does HTML stand for?",
    anser1: "Home Tool Markup Language",
    anser2: "Hyperlink and Text Markup Language",
    anser3: "Hyper Tool Markup Language",
    anser4: "Hyper Text Markup Language",
    anserTrue: "Hyper Text Markup Language",
  }),
  (q2 = {
    question: "Which is used to read an HTML page and render it?",
    anser1: "Web server",
    anser2: "Web browser",
    anser3: "Web matrix",
    anser4: "Web network",
    anserTrue: "Web browser",
  }),
  (q3 = {
    question: "Choose the correct HTML element for the largest heading:",
    anser1: "<heading>",
    anser2: "<h6>",
    anser3: "<h1>",
    anser4: "<head>",
    anserTrue: "<h1>",
  }),
  (q4 = {
    question: "What is the correct HTML element for inserting a line break?",
    anser1: "<br>",
    anser2: "<lb>",
    anser3: "<brk>",
    anser4: "<brake>",
    anserTrue: "<br>",
  }),
  (q5 = {
    question: "HTML is a set of markup ___.",
    anser1: "sets",
    anser2: "attributes",
    anser3: "tags",
    anser4: "none of the above",
    anserTrue: "tags",
  }),
  (q6 = {
    question: "Which is used to open the document in new window ?",
    anser1: '<a target="_blank">Link</a>',
    anser2: '<a target="_new">Link</a>',
    anser3: '<a target="_parent">Link</a>',
    anser4: '<a target="_top">Link</a>',
    anserTrue: '<a target="_blank">Link</a>',
  }),
  (q7 = {
    question: "What is the correct syntax of doctype in HTML5?",
    anser1: "</doctype html>",
    anser2: "<doctype html!>",
    anser3: "<doctype html>",
    anser4: "<!doctype html>",
    anserTrue: "<!doctype html>",
  }),
  (q8 = {
    question: "In which part of the HTML metadata is contained?",
    anser1: "body tag",
    anser2: "head tag",
    anser3: "title tag",
    anser4: "html tag",
    anserTrue: "head tag",
  }),
  (q9 = {
    question: "Which element is used for or styling HTML5 layout?",
    anser1: "PHP",
    anser2: "JS",
    anser3: "JQuery",
    anser4: "CSS",
    anserTrue: "CSS",
  }),
  (q10 = {
    question: "Which defines the most important heading ?",
    anser1: "h8",
    anser2: "h1",
    anser3: "h6",
    anser4: "h4",
    anserTrue: "h1",
  }),
];


// Select Elements
let countSpan = document.querySelector(".count span");
let bullets = document.querySelector(".bullets");
let bulletsSpanContainer = document.querySelector(".bullets .spans");
let quizArea = document.querySelector(".quiz-area");
let answersArea = document.querySelector(".answers-area");
let submitButton = document.querySelector(".submit-button");
let resultsContainer = document.querySelector(".results");
let countdownElement = document.querySelector(".countdown");
let quizApp = document.querySelector(".quiz-app")


// Set Options
let currentIndex = 0;
let rightAnswers = 0;
let countdownInterval;
let questionCount = htmlQuestions.length
let choisArr = [];

//celect the right answers
let ansersTru = []
for(const ques of htmlQuestions) {
  ansersTru.push(ques.anserTrue)
}




//FUNCTIONS
//bullet function
function pagination(numb) {
  countSpan.innerHTML = numb

  //create the bullets
  for (let i = 0; i < questionCount; i++) {
    //span
    let bull = document.createElement('span')

    // Check If Its First Span
    if (i === 0) {
      bull.className = "on";
    }

    //append bull to bullets container
    bulletsSpanContainer.appendChild(bull)
    
  }
}

//function to add question
function addData(obj, count) {
  if (currentIndex < count) {
    
  //crete h2 question
  let questionTitel = document.createElement("h2");

  //create test node
  let questionText = document.createTextNode(obj.question);

  //append the text to h2
  questionTitel.appendChild(questionText);

  //append the questionTitel to quiz-area
  quizArea.appendChild(questionTitel);

  //adding the questions
  for (let i = 1; i <= 4; i++) {

    //create anser div
    let mainDiv = document.createElement('div');

    //add class to mainDiv
    mainDiv.className = "answer";

    //create radio input
    let radioTinput = document.createElement('input');
    radioTinput.type = "radio";
    radioTinput.name = "question";
    radioTinput.id = `answer${i}`;
    radioTinput.dataset.answer = obj[`anser${i}`];

    //create label
    let label = document.createElement("label");
    label.htmlFor = `answer${i}`;

    //create label text
    let labelText = document.createTextNode(obj[`anser${i}`]);

    //add text to the lable
    label.appendChild(labelText);

    //add input + label to mainDiv
    mainDiv.appendChild(radioTinput);
    mainDiv.appendChild(label);

    //add mainDiv to answers-area
    answersArea.appendChild(mainDiv)
  }
  }
}


//function to chesk
function checkAnswer(rAnswer) { //checkAnswer(treuanswer)

  let anwers = document.getElementsByName("question");
  let chois;

  //ida kanet mkochia ajoutiha f choisArr
  for(const anwer of anwers) {
    if (anwer.checked) {
      chois = anwer.dataset.answer
      choisArr.push(chois)
    }
  }
  console.log(chois);

  if (rAnswer === chois) {
    rightAnswers++;    
  }
  
} 





//change bullet
function changePagi() {

  let bulspans = document.querySelectorAll(".bullets .spans span");
  let bullArray = Array.from(bulspans);
  bullArray.forEach((span, index) => {
    if (currentIndex === index) {
      span.className = 'on';
    }
  })
}



//showResults function
function showResults(count) {

  
  let results;
  if (currentIndex === count) {
    quizArea.remove();
    answersArea.remove();
    submitButton.remove();
    bullets.remove();

    if (rightAnswers > count / 2 && rightAnswers < count) {
      results = `<span class="good">${rightAnswers}</span>`
    } else if (rightAnswers === count) {
      results = `<span class="perfect">${rightAnswers}</span>`
    } else {
      results = `<span class="bad">${rightAnswers}</span>`
    }
    resultsContainer.innerHTML = results

    //show right answers
    let buttenDiv = document.createElement('div')
    buttenDiv.classList = "show-ans"

    let showRightAnswers = document.createElement('button');
    showRightAnswers.className = "btn_Show"
    showRightAnswers.innerHTML = "Show Right Answers"

    buttenDiv.appendChild(showRightAnswers)

    quizApp.appendChild(buttenDiv)
    
    showRightAnswers.onclick = function () {
      showRightAnswers.remove();
      show(choisArr);

      //restart button
      let reSetDiv = document.createElement("div");
      reSetDiv.className = "reSetDiv";

      let restart = document.createElement('button');
      restart.className = "submit-button";
      restart.innerText = "restart"

      reSetDiv.appendChild(restart);
      quizApp.appendChild(reSetDiv);

      restart.onclick = function () {
          location.reload();
      }
    }
  }
}

function show(arr) {
  //create div
  let truDiv = document.createElement('div')
  truDiv.className = "truAns"

  //append truDiv to quizApp
  quizApp.appendChild(truDiv)

  for (let i = 0; i < choisArr.length; i++) {

    //create P
    let pAns = document.createElement('p')
    pAns.className = "pAns"
    let pText = document.createTextNode(arr[i])

    //add the true aanswers
    pAns.appendChild(pText)
    truDiv.appendChild(pAns)
  }
  //############################### do a chack hear to see if the chois is in the ansersTru array 
  //############################### and then color the true answers 
  let pchoises = document.querySelectorAll(".pAns");
  for (const pchois of pchoises) {
    if (ansersTru.includes(pchois.innerText)) {
      pchois.style.backgroundImage = "linear-gradient(to top left, #39b385, #9be15d)";
    } else {
      pchois.style.backgroundImage = "linear-gradient(to top left, #fd424b, #ffcb03)";
    }
  }
}
//valide function
function valid() {
  
  //get the true answer
  let treuanswer = htmlQuestions[currentIndex].anserTrue

  //index++
  currentIndex++

  //check the answer
  checkAnswer(treuanswer) //questionCount

  //remouve old question
  quizArea.innerHTML = '';
  answersArea.innerHTML = '';
  
  //add next question
  addData(htmlQuestions[currentIndex], questionCount)

  //change bullet
  changePagi();

  //results
  showResults(questionCount);
  
}

//trigger the functions
//create bullets
pagination(questionCount)

//add questions
addData(htmlQuestions[currentIndex], questionCount)

//submit button
submitButton.addEventListener('click', valid)